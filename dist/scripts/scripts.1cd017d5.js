"use strict";angular.module("schedulizer",["firebase","angular-md5","ui.router"]).config(function(a,b){a.state("home",{url:"/",templateUrl:"home/home.html",resolve:{requireNoAuth:function(a,b){return b.$requireAuth().then(function(b){a.go("channels")},function(a){})}}}).state("login",{url:"/login",controller:"AuthCtrl as authCtrl",templateUrl:"auth/login.html",resolve:{requireNoAuth:function(a,b){return b.$requireAuth().then(function(b){a.go("home")},function(a){})}}}).state("register",{url:"/register",controller:"AuthCtrl as authCtrl",templateUrl:"auth/register.html",resolve:{requireNoAuth:function(a,b){return b.$requireAuth().then(function(b){a.go("home")},function(a){})}}}).state("schedule",{url:"/schedule",controller:"ScheduleCtrl as scheduleCtrl",templateUrl:"calendar/calendar.html",resolve:{auth:function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("schedule")})},profile:function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}}}).state("profile",{url:"/profile",controller:"ProfileCtrl as profileCtrl",templateUrl:"users/profile.html",resolve:{auth:function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})},profile:function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}}}).state("channels",{url:"/channels",controller:"ChannelsCtrl as channelsCtrl",templateUrl:"channels/index.html",resolve:{channels:function(a){return a.$loaded()},profile:function(a,b,c){return b.$requireAuth().then(function(b){return c.getProfile(b.uid).$loaded().then(function(b){return b.displayName?b:void a.go("profile")})},function(b){a.go("home")})}}}).state("channels.create",{url:"/create",templateUrl:"channels/create.html",controller:"ChannelsCtrl as channelsCtrl"}).state("channels.messages",{url:"/{channelId}/messages",templateUrl:"channels/messages.html",controller:"MessagesCtrl as messagesCtrl",resolve:{messages:function(a,b){return b.forChannel(a.channelId).$loaded()},channelName:function(a,b){return"#"+b.$getRecord(a.channelId).name}}}).state("channels.direct",{url:"/{uid}/messages/direct",templateUrl:"channels/messages.html",controller:"MessagesCtrl as messagesCtrl",resolve:{messages:function(a,b,c){return b.forUsers(a.uid,c.$id).$loaded()},channelName:function(a,b){return b.all.$loaded().then(function(){return"@"+b.getDisplayName(a.uid)})}}}),b.otherwise("/")}).constant("FirebaseUrl","https://finalprojectgarza.firebaseio.com/"),angular.module("schedulizer").controller("AuthCtrl",function(a,b){var c=this;console.log(a),c.user={email:"",password:""},c.login=function(){a.$authWithPassword(c.user).then(function(a){b.go("home")},function(a){c.error=a})},c.register=function(){a.$createUser(c.user).then(function(a){c.login()},function(a){c.error=a})}}),angular.module("schedulizer").factory("Auth",function(a,b){var c=new Firebase(b),d=a(c);return d}),angular.module("schedulizer").factory("Users",function(a,b,c){var d=new Firebase(c+"users"),e=new Firebase(c+".info/connected"),f=a(d),g=new Firebase("https://finalprojectgarza.firebaseio.com/"),h=new GeoFire(g),i=h.ref();console.log("Geo Ref ",i);var j={getProfile:function(a){return b(d.child(a))},getDisplayName:function(a){return f.$getRecord(a).displayName},getGravatar:function(a){return"//www.gravatar.com/avatar/"+f.$getRecord(a).emailHash},setOnline:function(c){console.log("online");var f=b(e),g=a(d.child(c+"/online"));f.$watch(function(){f.$value===!0&&g.$add(!0).then(function(a){a.onDisconnect().remove()})})},all:f};return j}),angular.module("schedulizer").controller("ProfileCtrl",function(a,b,c,d){var e=this;e.profile=d,e.updateProfile=function(){e.profile.emailHash=b.createHash(c.password.email),e.profile.$save().then(function(){a.go("channels")})}}),angular.module("schedulizer").controller("ChannelsCtrl",function(a,b,c,d,e){var f=this;f.profile=d,f.channels=e,f.users=c.all,f.getDisplayName=c.getDisplayName,f.getGravatar=c.getGravatar,c.setOnline(d.$id),f.logout=function(){f.profile.online=null,f.profile.$save().then(function(){b.$unauth(),a.go("home")})},f.newChannel={name:""},f.createChannel=function(){f.channels.$add(f.newChannel).then(function(b){a.go("channels.messages",{channelId:b.key()})})}}),angular.module("schedulizer").factory("Channels",function(a,b){var c=new Firebase(b+"channels"),d=a(c);return d}),angular.module("schedulizer").factory("Messages",function(a,b){var c=new Firebase(b+"channelMessages"),d=new Firebase(b+"userMessages");return{forChannel:function(b){return a(c.child(b))},forUsers:function(b,c){var e=c>b?b+"/"+c:c+"/"+b;return a(d.child(e))}}}),angular.module("schedulizer").controller("MessagesCtrl",function(a,b,c){var d=this;d.messages=c,d.channelName=b,d.message="",d.sendMessage=function(){d.message.length>0&&d.messages.$add({uid:a.$id,body:d.message,timestamp:Firebase.ServerValue.TIMESTAMP}).then(function(){d.message=""})}}),angular.module("schedulizer").controller("ScheduleCtrl",function(a,b,c,d){var e=new Firebase("https://finalprojectschedule.firebaseio.com/days"),f=c(e);a.days=f,a.reset=function(){e.set({monday:{name:"Monday",slots:{900:{time:"9:00am",booked:!1},72:{time:"11:00am",booked:!1},100:{time:"1:00pm",booked:!1},300:{time:"3:00pm",booked:!1},500:{time:"5:00pm",booked:!1},700:{time:"7:00pm",booked:!1}}},tuesday:{name:"Tuesday",slots:{900:{time:"9:00am",booked:!1},72:{time:"11:00am",booked:!1},100:{time:"1:00pm",booked:!1},300:{time:"3:00pm",booked:!1},500:{time:"5:00pm",booked:!1},700:{time:"7:00pm",booked:!1}}},wednesday:{name:"Wednesday",slots:{900:{time:"9:00am",booked:!1},72:{time:"11:00am",booked:!1},100:{time:"1:00pm",booked:!1},300:{time:"3:00pm",booked:!1},500:{time:"5:00pm",booked:!1},700:{time:"7:00pm",booked:!1}}}})}});